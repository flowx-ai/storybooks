import{r as _}from"./index-Bv9Y92EF.js";import{c as st,d as v,E as ct,u as ht}from"./useRenderElement-CQQ5I8lv.js";import{u as gt,C as dt}from"./useButton-BpCaeLYm.js";import{u as mt,C as Rt}from"./CompositeList-oGVV_oZ2.js";import{c as tt}from"./floating-ui.utils.dom-cLmtQo3s.js";import{s as et,A as Et,a as Ct,i as nt,b as V,c as X,H as yt,E as At,d as rt,e as Z,V as It,f as wt,g as Mt,h as Ot,M as _t}from"./composite-DpKW5ESM.js";import{f as it,u as bt}from"./DirectionContext-BpJw-_6G.js";import{s as D}from"./event-BieJfEq0.js";import{A as xt,b as kt,c as q,d as J}from"./owner-BLNona6N.js";import{j as ot}from"./jsx-runtime-DztICxWZ.js";function F(e,n,u){return Math.floor(e/n)!==u}function j(e,n){return n<0||n>=e.current.length}function Ht(e,n){return y(e,{disabledIndices:n})}function Kt(e,n){return y(e,{decrement:!0,startingIndex:e.current.length,disabledIndices:n})}function y(e,{startingIndex:n=-1,decrement:u=!1,disabledIndices:s,amount:m=1}={}){let t=n;do t+=u?-m:m;while(t>=0&&t<=e.current.length-1&&z(e,t,s));return t}function St(e,{event:n,orientation:u,loop:s,rtl:m,cols:t,disabledIndices:f,minIndex:I,maxIndex:E,prevIndex:i,stopEvent:c=!1}){let r=i;const g=[],p={};let P=!1;{let l=null,d=-1;e.current.forEach((h,a)=>{if(h==null)return;const R=h.closest('[role="row"]');R&&(P=!0),(R!==l||d===-1)&&(l=R,d+=1,g[d]=[]),g[d].push(a),p[a]=d})}const T=P&&g.length>0&&g.some(l=>l.length!==t);function b(l){if(!T||i===-1)return;const d=p[i];if(d==null)return;const h=g[d].indexOf(i);let a=l==="up"?d-1:d+1;s&&(a<0?a=g.length-1:a>=g.length&&(a=0));const R=new Set;for(;a>=0&&a<g.length&&!R.has(a);){R.add(a);const w=g[a];if(w.length===0){a=l==="up"?a-1:a+1;continue}const Y=Math.min(h,w.length-1);for(let x=Y;x>=0;x-=1){const o=w[x];if(!z(e,o,f))return o}a=l==="up"?a-1:a+1,s&&(a<0?a=g.length-1:a>=g.length&&(a=0))}}if(n.key===xt){const l=b("up");if(l!==void 0)c&&D(n),r=l;else{if(c&&D(n),i===-1)r=E;else if(r=y(e,{startingIndex:r,amount:t,decrement:!0,disabledIndices:f}),s&&(i-t<I||r<0)){const d=i%t,h=E%t,a=E-(h-d);h===d?r=E:r=h>d?a:a-t}j(e,r)&&(r=i)}}if(n.key===kt){const l=b("down");l!==void 0?(c&&D(n),r=l):(c&&D(n),i===-1?r=I:(r=y(e,{startingIndex:i,amount:t,disabledIndices:f}),s&&i+t>E&&(r=y(e,{startingIndex:i%t-t,amount:t,disabledIndices:f}))),j(e,r)&&(r=i))}if(u==="both"){const l=it(i/t);n.key===(m?q:J)&&(c&&D(n),i%t!==t-1?(r=y(e,{startingIndex:i,disabledIndices:f}),s&&F(r,t,l)&&(r=y(e,{startingIndex:i-i%t-1,disabledIndices:f}))):s&&(r=y(e,{startingIndex:i-i%t-1,disabledIndices:f})),F(r,t,l)&&(r=i)),n.key===(m?J:q)&&(c&&D(n),i%t!==0?(r=y(e,{startingIndex:i,decrement:!0,disabledIndices:f}),s&&F(r,t,l)&&(r=y(e,{startingIndex:i+(t-i%t),decrement:!0,disabledIndices:f}))):s&&(r=y(e,{startingIndex:i+(t-i%t),decrement:!0,disabledIndices:f})),F(r,t,l)&&(r=i));const d=it(E/t)===l;j(e,r)&&(s&&d?r=n.key===(m?J:q)?E:y(e,{startingIndex:i-i%t-1,disabledIndices:f}):r=i)}return r}function pt(e,n,u){const s=[];let m=0;return e.forEach(({width:t,height:f},I)=>{let E=!1;for(u&&(m=0);!E;){const i=[];for(let c=0;c<t;c+=1)for(let r=0;r<f;r+=1)i.push(m+c+r*n);m%n+t<=n&&i.every(c=>s[c]==null)?(i.forEach(c=>{s[c]=I}),E=!0):m+=1}}),[...s]}function Tt(e,n,u,s,m){if(e===-1)return-1;const t=u.indexOf(e),f=n[e];switch(m){case"tl":return t;case"tr":return f?t+f.width-1:t;case"bl":return f?t+(f.height-1)*s:t;case"br":return u.lastIndexOf(e);default:return-1}}function Lt(e,n){return n.flatMap((u,s)=>e.includes(u)?[s]:[])}function z(e,n,u){if(typeof u=="function")return u(n);if(u)return u.includes(n);const s=e.current[n];return s==null||s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true"}const Pt="data-composite-item-active";function qt(e={}){const{highlightItemOnHover:n,highlightedIndex:u,onHighlightedIndexChange:s}=gt(),{ref:m,index:t}=mt(e),f=u===t,I=_.useRef(null),E=st(m,I);return{compositeProps:_.useMemo(()=>({tabIndex:f?0:-1,onFocus(){s(t)},onMouseMove(){const c=I.current;if(!n||!c)return;const r=c.hasAttribute("disabled")||c.ariaDisabled==="true";!f&&!r&&c.focus()}}),[f,s,t,n]),compositeRef:E,index:t}}function Yt(e){return e==null||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true"}const Dt=[];function Wt(e){const{itemSizes:n,cols:u=1,loop:s=!0,dense:m=!1,orientation:t="both",direction:f,highlightedIndex:I,onHighlightedIndexChange:E,rootRef:i,enableHomeAndEndKeys:c=!1,stopEventPropagation:r=!1,disabledIndices:g,modifierKeys:p=Dt}=e,[P,T]=_.useState(0),b=u>1,l=_.useRef(null),d=st(l,i),h=_.useRef([]),a=_.useRef(!1),R=I??P,w=tt((o,A=!1)=>{if((E??T)(o),A){const k=h.current[o];et(l.current,k,f,t)}}),Y=tt(o=>{if(o.size===0||a.current)return;a.current=!0;const A=Array.from(o.keys()),k=A.find(M=>M==null?void 0:M.hasAttribute(Pt))??null,H=k?A.indexOf(k):-1;H!==-1&&w(H),et(l.current,k,f,t)}),x=_.useMemo(()=>({"aria-orientation":t==="both"?void 0:t,ref:d,onFocus(o){!l.current||!nt(o.target)||o.target.setSelectionRange(0,o.target.value.length??0)},onKeyDown(o){const A=c?Et:Ct;if(!A.has(o.key)||zt(o,p)||!l.current)return;const H=f==="rtl",M=H?rt:X,B={horizontal:M,vertical:V,both:M}[t],L=H?X:rt,at={horizontal:L,vertical:Z,both:L}[t];if(nt(o.target)&&!Yt(o.target)){const O=o.target.selectionStart,K=o.target.selectionEnd,U=o.target.value??"";if(O==null||o.shiftKey||O!==K||o.key!==at&&O<U.length||o.key!==B&&O>0)return}let C=R;const N=Ht(h,g),G=Kt(h,g);if(b){const O=n||Array.from({length:h.current.length},()=>({width:1,height:1})),K=pt(O,u,m),U=K.findIndex(S=>S!=null&&!z(h,S,g)),ft=K.reduce((S,W,lt)=>W!=null&&!z(h,W,g)?lt:S,-1);C=K[St({current:K.map(S=>S?h.current[S]:null)},{event:o,orientation:t,loop:s,cols:u,disabledIndices:Lt([...g||h.current.map((S,W)=>z(h,W)?W:void 0),void 0],K),minIndex:U,maxIndex:ft,prevIndex:Tt(R>G?N:R,O,K,u,o.key===V?"bl":o.key===X?"tr":"tl"),rtl:H})]}const Q={horizontal:[M],vertical:[V],both:[M,V]}[t],$={horizontal:[L],vertical:[Z],both:[L,Z]}[t],ut=b?A:{horizontal:c?Mt:Ot,vertical:c?It:wt,both:A}[t];c&&(o.key===yt?C=N:o.key===At&&(C=G)),C===R&&(Q.includes(o.key)||$.includes(o.key))&&(s&&C===G&&Q.includes(o.key)?C=N:s&&C===N&&$.includes(o.key)?C=G:C=y(h,{startingIndex:C,decrement:$.includes(o.key),disabledIndices:g})),C!==R&&!j(h,C)&&(r&&o.stopPropagation(),ut.has(o.key)&&o.preventDefault(),w(C,!0),queueMicrotask(()=>{var O;(O=h.current[C])==null||O.focus()}))}}),[u,m,f,g,h,c,R,b,n,s,d,p,w,t,r]);return _.useMemo(()=>({props:x,highlightedIndex:R,onHighlightedIndexChange:w,elementsRef:h,disabledIndices:g,onMapChange:Y}),[x,R,w,h,g,Y])}function zt(e,n){for(const u of _t.values())if(!n.includes(u)&&e.getModifierState(u))return!0;return!1}function Jt(e){const{render:n,className:u,refs:s=v,props:m=v,state:t=ct,stateAttributesMapping:f,highlightedIndex:I,onHighlightedIndexChange:E,orientation:i,dense:c,itemSizes:r,loop:g,cols:p,enableHomeAndEndKeys:P,onMapChange:T,stopEventPropagation:b=!0,rootRef:l,disabledIndices:d,modifierKeys:h,highlightItemOnHover:a=!1,tag:R="div",...w}=e,Y=bt(),{props:x,highlightedIndex:o,onHighlightedIndexChange:A,elementsRef:k,onMapChange:H}=Wt({itemSizes:r,cols:p,loop:g,dense:c,orientation:i,highlightedIndex:I,onHighlightedIndexChange:E,rootRef:l,stopEventPropagation:b,enableHomeAndEndKeys:P,direction:Y,disabledIndices:d,modifierKeys:h}),M=ht(R,e,{state:t,ref:s,props:[x,...m,w],stateAttributesMapping:f}),B=_.useMemo(()=>({highlightedIndex:o,onHighlightedIndexChange:A,highlightItemOnHover:a}),[o,A,a]);return ot.jsx(dt.Provider,{value:B,children:ot.jsx(Rt,{elementsRef:k,onMapChange:L=>{T==null||T(L),H(L)},children:M})})}export{Pt as A,Jt as C,qt as u};
