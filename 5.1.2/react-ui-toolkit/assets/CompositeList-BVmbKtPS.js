import{r as o}from"./index-Bv9Y92EF.js";import{u as x,b as E}from"./floating-ui.utils.dom-BFiwr5bk.js";import{b as R}from"./useRenderElement-IQYmzFOi.js";import{j as L}from"./jsx-runtime-DztICxWZ.js";const T=o.createContext({register:()=>{},unregister:()=>{},subscribeMapChange:()=>()=>{},elementsRef:{current:[]},nextIndexRef:{current:0}});function D(){return o.useContext(T)}let S=(function(u){return u[u.None=0]="None",u[u.GuessFromOrder=1]="GuessFromOrder",u})({});function y(u={}){const{label:m,metadata:t,textRef:s,indexGuessBehavior:I,index:f}=u,{register:O,unregister:p,subscribeMapChange:d,elementsRef:C,labelsRef:N,nextIndexRef:i}=D(),M=o.useRef(-1),[a,n]=o.useState(f??(I===S.GuessFromOrder?()=>{if(M.current===-1){const e=i.current;i.current+=1,M.current=e}return M.current}:-1)),h=o.useRef(null),g=o.useCallback(e=>{var c;if(h.current=e,a!==-1&&e!==null&&(C.current[a]=e,N)){const r=m!==void 0;N.current[a]=r?m:((c=s==null?void 0:s.current)==null?void 0:c.textContent)??e.textContent}},[a,C,N,m,s]);return x(()=>{if(f!=null)return;const e=h.current;if(e)return O(e,t),()=>{p(e)}},[f,O,p,t]),x(()=>{if(f==null)return d(e=>{var r;const c=h.current?(r=e.get(h.current))==null?void 0:r.index:null;c!=null&&n(c)})},[f,d,n]),o.useMemo(()=>({ref:g,index:a}),[a,g])}function F(u){const{children:m,elementsRef:t,labelsRef:s,onMapChange:I}=u,f=E(I),O=o.useRef(0),p=R(P).current,d=R(_).current,[C,N]=o.useState(0),i=o.useRef(C),M=E((e,c)=>{d.set(e,c??null),i.current+=1,N(i.current)}),a=E(e=>{d.delete(e),i.current+=1,N(i.current)}),n=o.useMemo(()=>{const e=new Map;return Array.from(d.keys()).sort(w).forEach((r,b)=>{const l=d.get(r)??{};e.set(r,{...l,index:b})}),e},[d,C]);x(()=>{if(typeof MutationObserver!="function"||n.size===0)return;const e=new MutationObserver(c=>{const r=new Set,b=l=>r.has(l)?r.delete(l):r.add(l);c.forEach(l=>{l.removedNodes.forEach(b),l.addedNodes.forEach(b)}),r.size===0&&(i.current+=1,N(i.current))});return n.forEach((c,r)=>{r.parentElement&&e.observe(r.parentElement,{childList:!0})}),()=>{e.disconnect()}},[n]),x(()=>{i.current===C&&(t.current.length!==n.size&&(t.current.length=n.size),s&&s.current.length!==n.size&&(s.current.length=n.size),O.current=n.size),f(n)},[f,n,t,s,C]),x(()=>()=>{t.current=[]},[t]),x(()=>()=>{s&&(s.current=[])},[s]);const h=E(e=>(p.add(e),()=>{p.delete(e)}));x(()=>{p.forEach(e=>e(n))},[p,n]);const g=o.useMemo(()=>({register:M,unregister:a,subscribeMapChange:h,elementsRef:t,labelsRef:s,nextIndexRef:O}),[M,a,h,t,s,O]);return L.jsx(T.Provider,{value:g,children:m})}function _(){return new Map}function P(){return new Set}function w(u,m){const t=u.compareDocumentPosition(m);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0}export{F as C,y as u};
