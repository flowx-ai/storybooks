import{r as _}from"./index-Bv9Y92EF.js";import{c as at,d as tt,E as ct,u as ht}from"./useRenderElement-IQYmzFOi.js";import{u as dt,C as gt}from"./useButton-BU0a48-b.js";import{u as mt,C as Rt}from"./CompositeList-BVmbKtPS.js";import{b as et}from"./floating-ui.utils.dom-BFiwr5bk.js";import{s as nt,A as Et,a as yt,i as rt,b as j,c as q,H as Ct,E as At,d as it,e as J,V as wt,f as It,g as bt,h as Mt,M as Ot}from"./composite-BcX4eBbW.js";import{f as ot,u as _t}from"./DirectionContext-C0NX5zCF.js";import{s as Y}from"./event-BYna9Hj-.js";import{A as Kt,b as xt,c as F,d as Q}from"./owner-CUO6ebsU.js";import{j as st}from"./jsx-runtime-DztICxWZ.js";function B(e,n,u){return Math.floor(e/n)!==u}function $(e,n){return n<0||n>=e.current.length}function kt(e,n){return C(e,{disabledIndices:n})}function Ht(e,n){return C(e,{decrement:!0,startingIndex:e.current.length,disabledIndices:n})}function C(e,{startingIndex:n=-1,decrement:u=!1,disabledIndices:s,amount:m=1}={}){let t=n;do t+=u?-m:m;while(t>=0&&t<=e.current.length-1&&z(e,t,s));return t}function St(e,{event:n,orientation:u,loopFocus:s,rtl:m,cols:t,disabledIndices:f,minIndex:w,maxIndex:E,prevIndex:i,stopEvent:c=!1}){let r=i;const d=[],p={};let L=!1;{let l=null,g=-1;e.current.forEach((h,a)=>{if(h==null)return;const R=h.closest('[role="row"]');R&&(L=!0),(R!==l||g===-1)&&(l=R,g+=1,d[g]=[]),d[g].push(a),p[a]=g})}const T=L&&d.length>0&&d.some(l=>l.length!==t);function K(l){if(!T||i===-1)return;const g=p[i];if(g==null)return;const h=d[g].indexOf(i);let a=l==="up"?g-1:g+1;s&&(a<0?a=d.length-1:a>=d.length&&(a=0));const R=new Set;for(;a>=0&&a<d.length&&!R.has(a);){R.add(a);const I=d[a];if(I.length===0){a=l==="up"?a-1:a+1;continue}const D=Math.min(h,I.length-1);for(let O=D;O>=0;O-=1){const o=I[O];if(!z(e,o,f))return o}a=l==="up"?a-1:a+1,s&&(a<0?a=d.length-1:a>=d.length&&(a=0))}}if(n.key===Kt){const l=K("up");if(l!==void 0)c&&Y(n),r=l;else{if(c&&Y(n),i===-1)r=E;else if(r=C(e,{startingIndex:r,amount:t,decrement:!0,disabledIndices:f}),s&&(i-t<w||r<0)){const g=i%t,h=E%t,a=E-(h-g);h===g?r=E:r=h>g?a:a-t}$(e,r)&&(r=i)}}if(n.key===xt){const l=K("down");l!==void 0?(c&&Y(n),r=l):(c&&Y(n),i===-1?r=w:(r=C(e,{startingIndex:i,amount:t,disabledIndices:f}),s&&i+t>E&&(r=C(e,{startingIndex:i%t-t,amount:t,disabledIndices:f}))),$(e,r)&&(r=i))}if(u==="both"){const l=ot(i/t);n.key===(m?F:Q)&&(c&&Y(n),i%t!==t-1?(r=C(e,{startingIndex:i,disabledIndices:f}),s&&B(r,t,l)&&(r=C(e,{startingIndex:i-i%t-1,disabledIndices:f}))):s&&(r=C(e,{startingIndex:i-i%t-1,disabledIndices:f})),B(r,t,l)&&(r=i)),n.key===(m?Q:F)&&(c&&Y(n),i%t!==0?(r=C(e,{startingIndex:i,decrement:!0,disabledIndices:f}),s&&B(r,t,l)&&(r=C(e,{startingIndex:i+(t-i%t),decrement:!0,disabledIndices:f}))):s&&(r=C(e,{startingIndex:i+(t-i%t),decrement:!0,disabledIndices:f})),B(r,t,l)&&(r=i));const g=ot(E/t)===l;$(e,r)&&(s&&g?r=n.key===(m?Q:F)?E:C(e,{startingIndex:i-i%t-1,disabledIndices:f}):r=i)}return r}function pt(e,n,u){const s=[];let m=0;return e.forEach(({width:t,height:f},w)=>{let E=!1;for(u&&(m=0);!E;){const i=[];for(let c=0;c<t;c+=1)for(let r=0;r<f;r+=1)i.push(m+c+r*n);m%n+t<=n&&i.every(c=>s[c]==null)?(i.forEach(c=>{s[c]=w}),E=!0):m+=1}}),[...s]}function Tt(e,n,u,s,m){if(e===-1)return-1;const t=u.indexOf(e),f=n[e];switch(m){case"tl":return t;case"tr":return f?t+f.width-1:t;case"bl":return f?t+(f.height-1)*s:t;case"br":return u.lastIndexOf(e);default:return-1}}function Lt(e,n){return n.flatMap((u,s)=>e.includes(u)?[s]:[])}function z(e,n,u){if(typeof u=="function")return u(n);if(u)return u.includes(n);const s=e.current[n];return s?s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true":!1}const Dt="data-composite-item-active";function Jt(e={}){const{highlightItemOnHover:n,highlightedIndex:u,onHighlightedIndexChange:s}=dt(),{ref:m,index:t}=mt(e),f=u===t,w=_.useRef(null),E=at(m,w);return{compositeProps:_.useMemo(()=>({tabIndex:f?0:-1,onFocus(){s(t)},onMouseMove(){const c=w.current;if(!n||!c)return;const r=c.hasAttribute("disabled")||c.ariaDisabled==="true";!f&&!r&&c.focus()}}),[f,s,t,n]),compositeRef:E,index:t}}function Pt(e){return e==null||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true"}const Yt=[];function Wt(e){const{itemSizes:n,cols:u=1,loopFocus:s=!0,dense:m=!1,orientation:t="both",direction:f,highlightedIndex:w,onHighlightedIndexChange:E,rootRef:i,enableHomeAndEndKeys:c=!1,stopEventPropagation:r=!1,disabledIndices:d,modifierKeys:p=Yt}=e,[L,T]=_.useState(0),K=u>1,l=_.useRef(null),g=at(l,i),h=_.useRef([]),a=_.useRef(!1),R=w??L,I=et((o,A=!1)=>{if((E??T)(o),A){const x=h.current[o];nt(l.current,x,f,t)}}),D=et(o=>{if(o.size===0||a.current)return;a.current=!0;const A=Array.from(o.keys()),x=A.find(b=>b==null?void 0:b.hasAttribute(Dt))??null,k=x?A.indexOf(x):-1;k!==-1&&I(k),nt(l.current,x,f,t)}),O=_.useMemo(()=>({"aria-orientation":t==="both"?void 0:t,ref:g,onFocus(o){!l.current||!rt(o.target)||o.target.setSelectionRange(0,o.target.value.length??0)},onKeyDown(o){const A=c?Et:yt;if(!A.has(o.key)||zt(o,p)||!l.current)return;const k=f==="rtl",b=k?it:q,U={horizontal:b,vertical:j,both:b}[t],P=k?q:it,N={horizontal:P,vertical:J,both:P}[t];if(rt(o.target)&&!Pt(o.target)){const M=o.target.selectionStart,H=o.target.selectionEnd,Z=o.target.value??"";if(M==null||o.shiftKey||M!==H||o.key!==N&&M<Z.length||o.key!==U&&M>0)return}let y=R;const G=kt(h,d),V=Ht(h,d);if(K){const M=n||Array.from({length:h.current.length},()=>({width:1,height:1})),H=pt(M,u,m),Z=H.findIndex(S=>S!=null&&!z(h,S,d)),ft=H.reduce((S,W,lt)=>W!=null&&!z(h,W,d)?lt:S,-1);y=H[St({current:H.map(S=>S?h.current[S]:null)},{event:o,orientation:t,loopFocus:s,cols:u,disabledIndices:Lt([...d||h.current.map((S,W)=>z(h,W)?W:void 0),void 0],H),minIndex:Z,maxIndex:ft,prevIndex:Tt(R>V?G:R,M,H,u,o.key===j?"bl":o.key===q?"tr":"tl"),rtl:k})]}const v={horizontal:[b],vertical:[j],both:[b,j]}[t],X={horizontal:[P],vertical:[J],both:[P,J]}[t],ut=K?A:{horizontal:c?bt:Mt,vertical:c?wt:It,both:A}[t];c&&(o.key===Ct?y=G:o.key===At&&(y=V)),y===R&&(v.includes(o.key)||X.includes(o.key))&&(s&&y===V&&v.includes(o.key)?y=G:s&&y===G&&X.includes(o.key)?y=V:y=C(h,{startingIndex:y,decrement:X.includes(o.key),disabledIndices:d})),y!==R&&!$(h,y)&&(r&&o.stopPropagation(),ut.has(o.key)&&o.preventDefault(),I(y,!0),queueMicrotask(()=>{var M;(M=h.current[y])==null||M.focus()}))}}),[u,m,f,d,h,c,R,K,n,s,g,p,I,t,r]);return _.useMemo(()=>({props:O,highlightedIndex:R,onHighlightedIndexChange:I,elementsRef:h,disabledIndices:d,onMapChange:D,relayKeyboardEvent:O.onKeyDown}),[O,R,I,h,d,D])}function zt(e,n){for(const u of Ot.values())if(!n.includes(u)&&e.getModifierState(u))return!0;return!1}function Ft(e){const{render:n,className:u,refs:s=tt,props:m=tt,state:t=ct,stateAttributesMapping:f,highlightedIndex:w,onHighlightedIndexChange:E,orientation:i,dense:c,itemSizes:r,loopFocus:d,cols:p,enableHomeAndEndKeys:L,onMapChange:T,stopEventPropagation:K=!0,rootRef:l,disabledIndices:g,modifierKeys:h,highlightItemOnHover:a=!1,tag:R="div",...I}=e,D=_t(),{props:O,highlightedIndex:o,onHighlightedIndexChange:A,elementsRef:x,onMapChange:k,relayKeyboardEvent:b}=Wt({itemSizes:r,cols:p,loopFocus:d,dense:c,orientation:i,highlightedIndex:w,onHighlightedIndexChange:E,rootRef:l,stopEventPropagation:K,enableHomeAndEndKeys:L,direction:D,disabledIndices:g,modifierKeys:h}),U=ht(R,e,{state:t,ref:s,props:[O,...m,I],stateAttributesMapping:f}),P=_.useMemo(()=>({highlightedIndex:o,onHighlightedIndexChange:A,highlightItemOnHover:a,relayKeyboardEvent:b}),[o,A,a,b]);return st.jsx(gt.Provider,{value:P,children:st.jsx(Rt,{elementsRef:x,onMapChange:N=>{T==null||T(N),k(N)},children:U})})}export{Dt as A,Ft as C,Jt as u};
