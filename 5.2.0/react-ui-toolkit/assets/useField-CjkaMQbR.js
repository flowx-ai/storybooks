import{r as f}from"./index-Bv9Y92EF.js";import{N as d,f as J,m as A,E as K}from"./useRenderElement-CQQ5I8lv.js";import{u as q}from"./useInteractions-DwvY_w4P.js";import{c as z,u as L}from"./floating-ui.utils.dom-cLmtQo3s.js";import{r as G}from"./index-DZfHsFkt.js";import{u as H}from"./useOpenChangeComplete-DtBfQTi2.js";let _=(function(e){return e.disabled="data-disabled",e.valid="data-valid",e.invalid="data-invalid",e.touched="data-touched",e.dirty="data-dirty",e.filled="data-filled",e.focused="data-focused",e})({});const w={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valid:null,valueMissing:!1},ne={valid(e){return e===null?null:e?{[_.valid]:""}:{[_.invalid]:""}}},Q=f.createContext({invalid:void 0,name:void 0,validityData:{state:w,errors:[],error:"",value:"",initialValue:null},setValidityData:d,disabled:void 0,touched:!1,setTouched:d,dirty:!1,setDirty:d,filled:!1,setFilled:d,focused:!1,setFocused:d,validate:()=>null,validationMode:"onBlur",validationDebounceTime:0,state:{disabled:!1,valid:null,touched:!1,dirty:!1,filled:!1,focused:!1},markedDirtyRef:{current:!1}});function B(e=!0){const i=f.useContext(Q);if(i.setValidityData===d&&!e)throw new Error(J(28));return i}const W=f.createContext({controlId:void 0,setControlId:d,labelId:void 0,setLabelId:d,messageIds:[],setMessageIds:d,getDescriptionProps:e=>e});function X(){return f.useContext(W)}const Z=f.createContext({formRef:{current:{fields:new Map}},errors:{},clearErrors:d});function U(){return f.useContext(Z)}function S(e,i){return{...e,state:{...e.state,valid:!i&&e.state.valid}}}const P=Object.keys(w);function $(e){if(!e||e.valid||!e.valueMissing)return!1;let i=!1;for(const u of P)u!=="valid"&&(u==="valueMissing"&&(i=e[u]),e[u]&&(i=!1));return i}function se(){const{setValidityData:e,validate:i,validityData:u,validationMode:C,validationDebounceTime:c,invalid:E,markedDirtyRef:b,state:V,name:v}=B(),{controlId:m,getDescriptionProps:h}=X(),{formRef:M,clearErrors:n}=U(),r=q(),p=f.useRef(null),y=z(async(x,D=!1)=>{const t=p.current;if(!t)return;if(D){if(V.valid!==!1)return;const g=t.validity;if(!g.valueMissing){const o={value:x,state:{...w,valid:!0},error:"",errors:[],initialValue:u.initialValue};if(t.setCustomValidity(""),m){const a=M.current.fields.get(m);a&&M.current.fields.set(m,{...a,...S(o,!1)})}e(o);return}const l=P.reduce((o,a)=>(o[a]=g[a],o),{});if(!l.valid&&!$(l))return}function Y(g){const l=P.reduce((a,T)=>(a[T]=g.validity[T],a),{});let o=!1;for(const a of P)if(a!=="valid"){if(a==="valueMissing"&&l[a])o=!0;else if(l[a])return l}return o&&!b.current&&(l.valid=!0,l.valueMissing=!1),l}r.clear();let s=null,I=[];const O=Y(t);let k;if(t.validationMessage&&C!=="onChange")k=t.validationMessage,I=[t.validationMessage];else{const g=Array.from(M.current.fields.values()).reduce((o,a)=>{var T,N;return a.name&&a.getValueRef&&(o[a.name]=(N=(T=a.getValueRef).current)==null?void 0:N.call(T)),o},{}),l=i(x,g);typeof l=="object"&&l!==null&&"then"in l?s=await l:s=l,s!==null?(O.valid=!1,O.customError=!0,Array.isArray(s)?(I=s,t.setCustomValidity(s.join(`
`))):s&&(I=[s],t.setCustomValidity(s))):C==="onChange"&&(t.setCustomValidity(""),O.customError=!1,t.validationMessage&&(k=t.validationMessage,I=[t.validationMessage]))}const j={value:x,state:O,error:k??(Array.isArray(s)?s[0]:s??""),errors:I,initialValue:u.initialValue};if(m){const g=M.current.fields.get(m);g&&M.current.fields.set(m,{...g,...S(j,E)})}e(j)}),R=f.useCallback((x={})=>A(h,V.valid===!1?{"aria-invalid":!0}:K,x),[h,V.valid]),F=f.useCallback((x={})=>A({onChange(D){if(D.nativeEvent.defaultPrevented)return;if(n(v),C!=="onChange"){y(D.currentTarget.value,!0);return}if(E)return;const t=D.currentTarget;if(t.value===""){y(t.value);return}r.clear(),c?r.start(c,()=>{y(t.value)}):y(t.value)}},R(x)),[R,n,v,r,y,E,C,c]);return f.useMemo(()=>({getValidationProps:R,getInputValidationProps:F,inputRef:p,commitValidation:y}),[R,F,y])}function oe(e){const{formRef:i}=U(),{invalid:u,markedDirtyRef:C,validityData:c,setValidityData:E}=B(),{enabled:b=!0,value:V,id:v,name:m,controlRef:h,commitValidation:M}=e,n=H(e.getValue);L(()=>{var p;if(!b)return;let r=V;r===void 0&&(r=(p=n.current)==null?void 0:p.call(n)),c.initialValue===null&&r!==c.initialValue&&E(y=>({...y,initialValue:r}))},[b,E,V,c.initialValue,n]),L(()=>{b&&v&&i.current.fields.set(v,{controlRef:h,validityData:S(c,u),validate(){var p;let r=V;r===void 0&&(r=(p=n.current)==null?void 0:p.call(n)),C.current=!0,G.flushSync(()=>M(r))},getValueRef:n,name:m})},[M,h,b,i,n,v,u,C,m,c,V]),L(()=>{const r=i.current.fields;return()=>{v&&r.delete(v)}},[i,v])}export{B as a,se as b,U as c,oe as d,ne as f,X as u};
