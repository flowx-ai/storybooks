import{r as s}from"./iframe-DMgJMfTy.js";import{u as h,b}from"./floating-ui.utils.dom-BiKb4_oH.js";import{u as I}from"./useRenderElement-BDAcc6QV.js";import{j as L}from"./jsx-runtime-NtR90vs_.js";const T=s.createContext({register:()=>{},unregister:()=>{},subscribeMapChange:()=>()=>{},elementsRef:{current:[]},nextIndexRef:{current:0}});function D(){return s.useContext(T)}let S=(function(o){return o[o.None=0]="None",o[o.GuessFromOrder=1]="GuessFromOrder",o})({});function y(o={}){const{label:m,metadata:t,textRef:r,indexGuessBehavior:E,index:f}=o,{register:O,unregister:p,subscribeMapChange:d,elementsRef:C,labelsRef:x,nextIndexRef:u}=D(),M=s.useRef(-1),[a,n]=s.useState(f??(E===S.GuessFromOrder?()=>{if(M.current===-1){const e=u.current;u.current+=1,M.current=e}return M.current}:-1)),N=s.useRef(null),g=s.useCallback(e=>{if(N.current=e,a!==-1&&e!==null&&(C.current[a]=e,x)){const c=m!==void 0;x.current[a]=c?m:r?.current?.textContent??e.textContent}},[a,C,x,m,r]);return h(()=>{if(f!=null)return;const e=N.current;if(e)return O(e,t),()=>{p(e)}},[f,O,p,t]),h(()=>{if(f==null)return d(e=>{const c=N.current?e.get(N.current)?.index:null;c!=null&&n(c)})},[f,d,n]),s.useMemo(()=>({ref:g,index:a}),[a,g])}function F(o){const{children:m,elementsRef:t,labelsRef:r,onMapChange:E}=o,f=b(E),O=s.useRef(0),p=I(P).current,d=I(_).current,[C,x]=s.useState(0),u=s.useRef(C),M=b((e,c)=>{d.set(e,c??null),u.current+=1,x(u.current)}),a=b(e=>{d.delete(e),u.current+=1,x(u.current)}),n=s.useMemo(()=>{const e=new Map;return Array.from(d.keys()).sort(w).forEach((i,R)=>{const l=d.get(i)??{};e.set(i,{...l,index:R})}),e},[d,C]);h(()=>{if(typeof MutationObserver!="function"||n.size===0)return;const e=new MutationObserver(c=>{const i=new Set,R=l=>i.has(l)?i.delete(l):i.add(l);c.forEach(l=>{l.removedNodes.forEach(R),l.addedNodes.forEach(R)}),i.size===0&&(u.current+=1,x(u.current))});return n.forEach((c,i)=>{i.parentElement&&e.observe(i.parentElement,{childList:!0})}),()=>{e.disconnect()}},[n]),h(()=>{u.current===C&&(t.current.length!==n.size&&(t.current.length=n.size),r&&r.current.length!==n.size&&(r.current.length=n.size),O.current=n.size),f(n)},[f,n,t,r,C]),h(()=>()=>{t.current=[]},[t]),h(()=>()=>{r&&(r.current=[])},[r]);const N=b(e=>(p.add(e),()=>{p.delete(e)}));h(()=>{p.forEach(e=>e(n))},[p,n]);const g=s.useMemo(()=>({register:M,unregister:a,subscribeMapChange:N,elementsRef:t,labelsRef:r,nextIndexRef:O}),[M,a,N,t,r,O]);return L.jsx(T.Provider,{value:g,children:m})}function _(){return new Map}function P(){return new Set}function w(o,m){const t=o.compareDocumentPosition(m);return t&Node.DOCUMENT_POSITION_FOLLOWING||t&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:t&Node.DOCUMENT_POSITION_PRECEDING||t&Node.DOCUMENT_POSITION_CONTAINS?1:0}export{F as C,y as u};
