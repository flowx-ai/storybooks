import{r as p}from"./iframe-DMgJMfTy.js";import{c as at,d as tt,E as ct,b as ht}from"./useRenderElement-BDAcc6QV.js";import{u as gt,C as dt}from"./useButton-By0iWj5u.js";import{u as mt,C as Rt}from"./CompositeList-5uNVqjSg.js";import{b as et}from"./floating-ui.utils.dom-BiKb4_oH.js";import{s as nt,A as Et,a as yt,i as rt,b as j,c as q,H as Ct,E as At,d as it,e as J,V as wt,f as It,g as Mt,h as bt,M as pt}from"./composite-C45KQDT5.js";import{f as ot,u as Ot}from"./DirectionContext-P2oSrbZt.js";import{s as D}from"./event-BuaqxoFo.js";import{A as _t,b as Kt,c as F,d as Q}from"./owner-CwWlm1ZE.js";import{j as st}from"./jsx-runtime-NtR90vs_.js";function B(e,n,u){return Math.floor(e/n)!==u}function $(e,n){return n<0||n>=e.current.length}function xt(e,n){return C(e,{disabledIndices:n})}function kt(e,n){return C(e,{decrement:!0,startingIndex:e.current.length,disabledIndices:n})}function C(e,{startingIndex:n=-1,decrement:u=!1,disabledIndices:s,amount:m=1}={}){let t=n;do t+=u?-m:m;while(t>=0&&t<=e.current.length-1&&z(e,t,s));return t}function Ht(e,{event:n,orientation:u,loopFocus:s,rtl:m,cols:t,disabledIndices:f,minIndex:w,maxIndex:E,prevIndex:i,stopEvent:c=!1}){let r=i;const g=[],H={};let T=!1;{let l=null,d=-1;e.current.forEach((h,a)=>{if(h==null)return;const R=h.closest('[role="row"]');R&&(T=!0),(R!==l||d===-1)&&(l=R,d+=1,g[d]=[]),g[d].push(a),H[a]=d})}const Y=T&&g.length>0&&g.some(l=>l.length!==t);function O(l){if(!Y||i===-1)return;const d=H[i];if(d==null)return;const h=g[d].indexOf(i);let a=l==="up"?d-1:d+1;s&&(a<0?a=g.length-1:a>=g.length&&(a=0));const R=new Set;for(;a>=0&&a<g.length&&!R.has(a);){R.add(a);const I=g[a];if(I.length===0){a=l==="up"?a-1:a+1;continue}const P=Math.min(h,I.length-1);for(let M=P;M>=0;M-=1){const o=I[M];if(!z(e,o,f))return o}a=l==="up"?a-1:a+1,s&&(a<0?a=g.length-1:a>=g.length&&(a=0))}}if(n.key===_t){const l=O("up");if(l!==void 0)c&&D(n),r=l;else{if(c&&D(n),i===-1)r=E;else if(r=C(e,{startingIndex:r,amount:t,decrement:!0,disabledIndices:f}),s&&(i-t<w||r<0)){const d=i%t,h=E%t,a=E-(h-d);h===d?r=E:r=h>d?a:a-t}$(e,r)&&(r=i)}}if(n.key===Kt){const l=O("down");l!==void 0?(c&&D(n),r=l):(c&&D(n),i===-1?r=w:(r=C(e,{startingIndex:i,amount:t,disabledIndices:f}),s&&i+t>E&&(r=C(e,{startingIndex:i%t-t,amount:t,disabledIndices:f}))),$(e,r)&&(r=i))}if(u==="both"){const l=ot(i/t);n.key===(m?F:Q)&&(c&&D(n),i%t!==t-1?(r=C(e,{startingIndex:i,disabledIndices:f}),s&&B(r,t,l)&&(r=C(e,{startingIndex:i-i%t-1,disabledIndices:f}))):s&&(r=C(e,{startingIndex:i-i%t-1,disabledIndices:f})),B(r,t,l)&&(r=i)),n.key===(m?Q:F)&&(c&&D(n),i%t!==0?(r=C(e,{startingIndex:i,decrement:!0,disabledIndices:f}),s&&B(r,t,l)&&(r=C(e,{startingIndex:i+(t-i%t),decrement:!0,disabledIndices:f}))):s&&(r=C(e,{startingIndex:i+(t-i%t),decrement:!0,disabledIndices:f})),B(r,t,l)&&(r=i));const d=ot(E/t)===l;$(e,r)&&(s&&d?r=n.key===(m?Q:F)?E:C(e,{startingIndex:i-i%t-1,disabledIndices:f}):r=i)}return r}function St(e,n,u){const s=[];let m=0;return e.forEach(({width:t,height:f},w)=>{let E=!1;for(u&&(m=0);!E;){const i=[];for(let c=0;c<t;c+=1)for(let r=0;r<f;r+=1)i.push(m+c+r*n);m%n+t<=n&&i.every(c=>s[c]==null)?(i.forEach(c=>{s[c]=w}),E=!0):m+=1}}),[...s]}function Tt(e,n,u,s,m){if(e===-1)return-1;const t=u.indexOf(e),f=n[e];switch(m){case"tl":return t;case"tr":return f?t+f.width-1:t;case"bl":return f?t+(f.height-1)*s:t;case"br":return u.lastIndexOf(e);default:return-1}}function Pt(e,n){return n.flatMap((u,s)=>e.includes(u)?[s]:[])}function z(e,n,u){if(typeof u=="function")return u(n);if(u)return u.includes(n);const s=e.current[n];return s?s.hasAttribute("disabled")||s.getAttribute("aria-disabled")==="true":!1}const Lt="data-composite-item-active";function Jt(e={}){const{highlightItemOnHover:n,highlightedIndex:u,onHighlightedIndexChange:s}=gt(),{ref:m,index:t}=mt(e),f=u===t,w=p.useRef(null),E=at(m,w);return{compositeProps:p.useMemo(()=>({tabIndex:f?0:-1,onFocus(){s(t)},onMouseMove(){const c=w.current;if(!n||!c)return;const r=c.hasAttribute("disabled")||c.ariaDisabled==="true";!f&&!r&&c.focus()}}),[f,s,t,n]),compositeRef:E,index:t}}function Dt(e){return e==null||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true"}const Yt=[];function Wt(e){const{itemSizes:n,cols:u=1,loopFocus:s=!0,dense:m=!1,orientation:t="both",direction:f,highlightedIndex:w,onHighlightedIndexChange:E,rootRef:i,enableHomeAndEndKeys:c=!1,stopEventPropagation:r=!1,disabledIndices:g,modifierKeys:H=Yt}=e,[T,Y]=p.useState(0),O=u>1,l=p.useRef(null),d=at(l,i),h=p.useRef([]),a=p.useRef(!1),R=w??T,I=et((o,A=!1)=>{if((E??Y)(o),A){const _=h.current[o];nt(l.current,_,f,t)}}),P=et(o=>{if(o.size===0||a.current)return;a.current=!0;const A=Array.from(o.keys()),_=A.find(b=>b?.hasAttribute(Lt))??null,K=_?A.indexOf(_):-1;K!==-1&&I(K),nt(l.current,_,f,t)}),M=p.useMemo(()=>({"aria-orientation":t==="both"?void 0:t,ref:d,onFocus(o){!l.current||!rt(o.target)||o.target.setSelectionRange(0,o.target.value.length??0)},onKeyDown(o){const A=c?Et:yt;if(!A.has(o.key)||zt(o,H)||!l.current)return;const K=f==="rtl",b=K?it:q,U={horizontal:b,vertical:j,both:b}[t],L=K?q:it,N={horizontal:L,vertical:J,both:L}[t];if(rt(o.target)&&!Dt(o.target)){const S=o.target.selectionStart,x=o.target.selectionEnd,Z=o.target.value??"";if(S==null||o.shiftKey||S!==x||o.key!==N&&S<Z.length||o.key!==U&&S>0)return}let y=R;const G=xt(h,g),V=kt(h,g);if(O){const S=n||Array.from({length:h.current.length},()=>({width:1,height:1})),x=St(S,u,m),Z=x.findIndex(k=>k!=null&&!z(h,k,g)),ft=x.reduce((k,W,lt)=>W!=null&&!z(h,W,g)?lt:k,-1);y=x[Ht({current:x.map(k=>k?h.current[k]:null)},{event:o,orientation:t,loopFocus:s,cols:u,disabledIndices:Pt([...g||h.current.map((k,W)=>z(h,W)?W:void 0),void 0],x),minIndex:Z,maxIndex:ft,prevIndex:Tt(R>V?G:R,S,x,u,o.key===j?"bl":o.key===q?"tr":"tl"),rtl:K})]}const v={horizontal:[b],vertical:[j],both:[b,j]}[t],X={horizontal:[L],vertical:[J],both:[L,J]}[t],ut=O?A:{horizontal:c?Mt:bt,vertical:c?wt:It,both:A}[t];c&&(o.key===Ct?y=G:o.key===At&&(y=V)),y===R&&(v.includes(o.key)||X.includes(o.key))&&(s&&y===V&&v.includes(o.key)?y=G:s&&y===G&&X.includes(o.key)?y=V:y=C(h,{startingIndex:y,decrement:X.includes(o.key),disabledIndices:g})),y!==R&&!$(h,y)&&(r&&o.stopPropagation(),ut.has(o.key)&&o.preventDefault(),I(y,!0),queueMicrotask(()=>{h.current[y]?.focus()}))}}),[u,m,f,g,h,c,R,O,n,s,d,H,I,t,r]);return p.useMemo(()=>({props:M,highlightedIndex:R,onHighlightedIndexChange:I,elementsRef:h,disabledIndices:g,onMapChange:P,relayKeyboardEvent:M.onKeyDown}),[M,R,I,h,g,P])}function zt(e,n){for(const u of pt.values())if(!n.includes(u)&&e.getModifierState(u))return!0;return!1}function Ft(e){const{render:n,className:u,refs:s=tt,props:m=tt,state:t=ct,stateAttributesMapping:f,highlightedIndex:w,onHighlightedIndexChange:E,orientation:i,dense:c,itemSizes:r,loopFocus:g,cols:H,enableHomeAndEndKeys:T,onMapChange:Y,stopEventPropagation:O=!0,rootRef:l,disabledIndices:d,modifierKeys:h,highlightItemOnHover:a=!1,tag:R="div",...I}=e,P=Ot(),{props:M,highlightedIndex:o,onHighlightedIndexChange:A,elementsRef:_,onMapChange:K,relayKeyboardEvent:b}=Wt({itemSizes:r,cols:H,loopFocus:g,dense:c,orientation:i,highlightedIndex:w,onHighlightedIndexChange:E,rootRef:l,stopEventPropagation:O,enableHomeAndEndKeys:T,direction:P,disabledIndices:d,modifierKeys:h}),U=ht(R,e,{state:t,ref:s,props:[M,...m,I],stateAttributesMapping:f}),L=p.useMemo(()=>({highlightedIndex:o,onHighlightedIndexChange:A,highlightItemOnHover:a,relayKeyboardEvent:b}),[o,A,a,b]);return st.jsx(dt.Provider,{value:L,children:st.jsx(Rt,{elementsRef:_,onMapChange:N=>{Y?.(N),K(N)},children:U})})}export{Lt as A,Ft as C,Jt as u};
